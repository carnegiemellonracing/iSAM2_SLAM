<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>isam2.cpp &mdash; CMR Driverless Path Planning 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=359c27e9"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="isam2Node.cpp" href="isam2Nodecpp.html" />
    <link rel="prev" title="More CMR Driverless" href="more.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            CMR Driverless Path Planning
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="isam2.html">What is Factor Graph SLAM?</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">How to run iSAM2 on the EUFS simulator</a></li>
<li class="toctree-l1"><a class="reference internal" href="more.html">More CMR Driverless</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">isam2.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="isam2Nodecpp.html">isam2Node.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Scripts</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CMR Driverless Path Planning</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">isam2.cpp</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/isam2cpp.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="isam2-cpp">
<h1>isam2.cpp<a class="headerlink" href="#isam2-cpp" title="Permalink to this heading"></a></h1>
<dl class="cpp class">
<dt class="sig sig-object cpp" id="_CPPv48slamISAM">
<span id="_CPPv38slamISAM"></span><span id="_CPPv28slamISAM"></span><span id="slamISAM"></span><span class="target" id="classslamISAM"></span><span class="k"><span class="pre">class</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">slamISAM</span></span></span><a class="headerlink" href="#_CPPv48slamISAM" title="Permalink to this definition"></a><br /></dt>
<dd><p>A class that uses data association to discern new cones from previously seen cones and utilizes the iSAM2 model to perform SLAM. </p>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N8slamISAM4stepEDaN5gtsam5Pose2ERNSt6vectorI6Point2EER6vectorI6Point2EN5gtsam6Point2Elb">
<span id="_CPPv3N8slamISAM4stepEDaN5gtsam5Pose2ERNSt6vectorI6Point2EER6vectorI6Point2EN5gtsam6Point2Elb"></span><span id="_CPPv2N8slamISAM4stepEDaN5gtsam5Pose2ERNSt6vectorI6Point2EER6vectorI6Point2EN5gtsam6Point2Elb"></span><span id="slamISAM::step__auto.gtsam::Pose2.std::vector:Point2:R.vector:Point2:R.gtsam::Point2.l.b"></span><span class="target" id="classslamISAM_1a00e82e306602f32451124afb29364365"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv48slamISAM" title="slamISAM"><span class="n"><span class="pre">slamISAM</span></span></a><span class="p"><span class="pre">::</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">step</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">auto</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">logger</span></span>, <span class="n"><span class="pre">gtsam</span></span><span class="p"><span class="pre">::</span></span><span class="n"><span class="pre">Pose2</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">global_odom</span></span>, <span class="n"><span class="pre">std</span></span><span class="p"><span class="pre">::</span></span><span class="n"><span class="pre">vector</span></span><span class="p"><span class="pre">&lt;</span></span><span class="n"><span class="pre">Point2</span></span><span class="p"><span class="pre">&gt;</span></span><span class="w"> </span><span class="p"><span class="pre">&amp;</span></span><span class="n sig-param"><span class="pre">cone_obs</span></span>, <span class="n"><span class="pre">vector</span></span><span class="p"><span class="pre">&lt;</span></span><span class="n"><span class="pre">Point2</span></span><span class="p"><span class="pre">&gt;</span></span><span class="w"> </span><span class="p"><span class="pre">&amp;</span></span><span class="n sig-param"><span class="pre">orange_ref_cones</span></span>, <span class="n"><span class="pre">gtsam</span></span><span class="p"><span class="pre">::</span></span><span class="n"><span class="pre">Point2</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">velocity</span></span>, <span class="kt"><span class="pre">long</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">time_ns</span></span>, <span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">loopClosure</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N8slamISAM4stepEDaN5gtsam5Pose2ERNSt6vectorI6Point2EER6vectorI6Point2EN5gtsam6Point2Elb" title="Permalink to this definition"></a><br /></dt>
<dd><p>Updates iSAM2 model by first performing data association on the cones observed from current time stamp. After determining which of the observed cones are new cones, the new cones are added to the factor graph which will be used to update the iSAM2 model. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>logger</strong> – RCLCPP logger used to print information to the terminal</p></li>
<li><p><strong>global_odom</strong> – Pose2 type representing the global pose of the car as predicted by the motion model. This will be updated by step to hold the global pose of the car after the current time step.</p></li>
<li><p><strong>cone_obs</strong> – The memory address of the vector containing the relative positions (with respect to the car) of the cones observed at the current time step.</p></li>
<li><p><strong>orange_ref_cones</strong> – The memory address of the vector containing the positions of the orange cones observed at the start of the track. Will be used for loop closure</p></li>
<li><p><strong>velocity</strong> – The velocity of the car at the current time step. Used as a part of the motion model to calculate the current pose of the car.</p></li>
<li><p><strong>time_ns</strong> – The time elapsed from the previous time step. Used as a part of the motion model to calculate the current pose of the car.</p></li>
<li><p><strong>loopClosure</strong> – Boolean that will be updated if loop closure has been detected. </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N8slamISAM11t_associateEP6vectorI6Point2EP6vectorI5Pose2EP6vectorI5Pose2E5Pose2P6vectorIfEii">
<span id="_CPPv3N8slamISAM11t_associateEP6vectorI6Point2EP6vectorI5Pose2EP6vectorI5Pose2E5Pose2P6vectorIfEii"></span><span id="_CPPv2N8slamISAM11t_associateEP6vectorI6Point2EP6vectorI5Pose2EP6vectorI5Pose2E5Pose2P6vectorIfEii"></span><span id="slamISAM::t_associate__vector:Point2:P.vector:Pose2:P.vector:Pose2:P.Pose2.vector:float:P.i.i"></span><span class="target" id="classslamISAM_1ab07c8f29237621e0b929d4a7098bfd4f"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv48slamISAM" title="slamISAM"><span class="n"><span class="pre">slamISAM</span></span></a><span class="p"><span class="pre">::</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">t_associate</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">vector</span></span><span class="p"><span class="pre">&lt;</span></span><span class="n"><span class="pre">Point2</span></span><span class="p"><span class="pre">&gt;</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">cone_obs</span></span>, <span class="n"><span class="pre">vector</span></span><span class="p"><span class="pre">&lt;</span></span><span class="n"><span class="pre">Pose2</span></span><span class="p"><span class="pre">&gt;</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">global_obs_cones</span></span>, <span class="n"><span class="pre">vector</span></span><span class="p"><span class="pre">&lt;</span></span><span class="n"><span class="pre">Pose2</span></span><span class="p"><span class="pre">&gt;</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">all_cone_est</span></span>, <span class="n"><span class="pre">Pose2</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">global_odom</span></span>, <span class="n"><span class="pre">vector</span></span><span class="p"><span class="pre">&lt;</span></span><span class="kt"><span class="pre">float</span></span><span class="p"><span class="pre">&gt;</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">m_dist</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">lo</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">hi</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N8slamISAM11t_associateEP6vectorI6Point2EP6vectorI5Pose2EP6vectorI5Pose2E5Pose2P6vectorIfEii" title="Permalink to this definition"></a><br /></dt>
<dd><p>A function called by threads that will perform data association on the observed Point2 cones stored inside vector cone_obs. All calculated mahalanobis distances will be stored in vector m_dist. For a given time stamp, multiple threads will be spawned to calculate a subsection of the the mahalanobis distances from indices [lo, hi) </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>global_obs_cones</strong> – A vector containing the global position for the Point2 cones observed in the current time stamp</p></li>
<li><p><strong>all_cone_est</strong> – A vector containing the estimates for the poses of previously seen cones, calculated by the iSAM2 model</p></li>
<li><p><strong>global_odom</strong> – A Pose2 variable representing the global pose of the car.</p></li>
<li><p><strong>m_dist</strong> – A vector containing all the mahalanobis distance calculations that will need to be calculated for the current time stamp. Let n_landmarks represent the number of previously seen landmarks, m_dist is organized such that each set/multiple of n_landmarks + 1 elements corresponds to the mahalanobis distance between an observed cone and the global positions of all previously seen cones. The +1 represents the mahalanobis distance threshold (M_DIST_TH) These mahalanobis distances will be used to perform data association on the observed landmarks, by observing which previously seen cone had the smallest mahalanobis distance from the current observed cone. If the smallest distance is M_DIST_TH, then the current observed cone is a new cone</p></li>
<li><p><strong>lo</strong> – An integer representing the index in m_dist the current thread should start populating m_dist</p></li>
<li><p><strong>hi</strong> – An integer representing the index in m_dist the current thread should stop populating m_dist. Does not calculate the element at index hi </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N8slamISAM1XEi">
<span id="_CPPv3N8slamISAM1XEi"></span><span id="_CPPv2N8slamISAM1XEi"></span><span id="slamISAM::X__i"></span><span class="target" id="classslamISAM_1aec2ba37dcd63ad9e413e4c0f6d781065"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="n"><span class="pre">gtsam</span></span><span class="p"><span class="pre">::</span></span><span class="n"><span class="pre">Symbol</span></span><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv48slamISAM" title="slamISAM"><span class="n"><span class="pre">slamISAM</span></span></a><span class="p"><span class="pre">::</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">X</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">robot_pose_id</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N8slamISAM1XEi" title="Permalink to this definition"></a><br /></dt>
<dd><p>A function that returns a Symbol representing the nth pose where n = robot_pose_id. This function is used to represent a key for the accessing the nth car pose estimate from the iSAM2 model. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>robot_pose_id</strong> – The ID of the car pose </p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv4N8slamISAM1LEi">
<span id="_CPPv3N8slamISAM1LEi"></span><span id="_CPPv2N8slamISAM1LEi"></span><span id="slamISAM::L__i"></span><span class="target" id="classslamISAM_1a9aa5e2c7ac1424c97711c9a5734282d9"></span><span class="k"><span class="pre">inline</span></span><span class="w"> </span><span class="n"><span class="pre">gtsam</span></span><span class="p"><span class="pre">::</span></span><span class="n"><span class="pre">Symbol</span></span><span class="w"> </span><span class="sig-prename descclassname"><a class="reference internal" href="#_CPPv48slamISAM" title="slamISAM"><span class="n"><span class="pre">slamISAM</span></span></a><span class="p"><span class="pre">::</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">L</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="n sig-param"><span class="pre">cone_pose_id</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N8slamISAM1LEi" title="Permalink to this definition"></a><br /></dt>
<dd><p>A function that returns a Symbol representing the nth landmark where n = cone_pose_id. This function is used to represent a key for the accessing the nth car pose estimate from the iSAM2 model. </p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>cone_pose_id</strong> – The ID of the cone pose </p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="more.html" class="btn btn-neutral float-left" title="More CMR Driverless" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="isam2Nodecpp.html" class="btn btn-neutral float-right" title="isam2Node.cpp" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Carnegie Mellon Racing.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>