<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>iSAM2 SLAM: slamISAM Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">iSAM2 SLAM<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">Implementation of iSAM2 for Carnegie Mellon Racing&#39;s Driverless team</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="classslamISAM-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">slamISAM Class Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a0a0a8309cd7ce17d5256b5e8435af151" id="r_a0a0a8309cd7ce17d5256b5e8435af151"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0a0a8309cd7ce17d5256b5e8435af151">print_cones</a> (auto logger, std::vector&lt; Point2 &gt; &amp;cone_obs)</td></tr>
<tr class="memdesc:a0a0a8309cd7ce17d5256b5e8435af151"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints the positions of the observed cones stored within the vector cone_obs. For DEBUGGING purposes.  <br /></td></tr>
<tr class="separator:a0a0a8309cd7ce17d5256b5e8435af151"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab07c8f29237621e0b929d4a7098bfd4f" id="r_ab07c8f29237621e0b929d4a7098bfd4f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab07c8f29237621e0b929d4a7098bfd4f">t_associate</a> (vector&lt; Point2 &gt; *cone_obs, vector&lt; Pose2 &gt; *global_obs_cones, vector&lt; Pose2 &gt; *all_cone_est, Pose2 global_odom, vector&lt; float &gt; *m_dist, int lo, int hi)</td></tr>
<tr class="memdesc:ab07c8f29237621e0b929d4a7098bfd4f"><td class="mdescLeft">&#160;</td><td class="mdescRight">A function called by threads that will perform data association on the observed Point2 cones stored inside vector cone_obs. All calculated mahalanobis distances will be stored in vector m_dist. For a given time stamp, multiple threads will be spawned to calculate a subsection of the the mahalanobis distances from indices [lo, hi)  <br /></td></tr>
<tr class="separator:ab07c8f29237621e0b929d4a7098bfd4f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00e82e306602f32451124afb29364365" id="r_a00e82e306602f32451124afb29364365"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a00e82e306602f32451124afb29364365">step</a> (auto logger, gtsam::Pose2 global_odom, std::vector&lt; Point2 &gt; &amp;cone_obs, vector&lt; Point2 &gt; &amp;orange_ref_cones, gtsam::Point2 velocity, long time_ns, bool loopClosure)</td></tr>
<tr class="memdesc:a00e82e306602f32451124afb29364365"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates iSAM2 model by first performing data association on the cones observed from current time stamp. After determining which of the observed cones are new cones, the new cones are added to the factor graph which will be used to update the iSAM2 model.  <br /></td></tr>
<tr class="separator:a00e82e306602f32451124afb29364365"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a9a7bf54fb68cd6ad39cf2be656f1da4c" id="r_a9a7bf54fb68cd6ad39cf2be656f1da4c"><td class="memItemLeft" align="right" valign="top"><a id="a9a7bf54fb68cd6ad39cf2be656f1da4c" name="a9a7bf54fb68cd6ad39cf2be656f1da4c"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>n_landmarks</b></td></tr>
<tr class="separator:a9a7bf54fb68cd6ad39cf2be656f1da4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a557bf4cb56eae4be97a60f5ce65c365a" id="r_a557bf4cb56eae4be97a60f5ce65c365a"><td class="memItemLeft" align="right" valign="top"><a id="a557bf4cb56eae4be97a60f5ce65c365a" name="a557bf4cb56eae4be97a60f5ce65c365a"></a>
gtsam::Pose2&#160;</td><td class="memItemRight" valign="bottom"><b>robot_est</b></td></tr>
<tr class="separator:a557bf4cb56eae4be97a60f5ce65c365a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12db7db0ac15a3eeacba9330e922c9b7" id="r_a12db7db0ac15a3eeacba9330e922c9b7"><td class="memItemLeft" align="right" valign="top"><a id="a12db7db0ac15a3eeacba9330e922c9b7" name="a12db7db0ac15a3eeacba9330e922c9b7"></a>
std::vector&lt; gtsam::Pose2 &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>landmark_est</b></td></tr>
<tr class="separator:a12db7db0ac15a3eeacba9330e922c9b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f6520c125e1db548f1a088ace7a042e" id="r_a1f6520c125e1db548f1a088ace7a042e"><td class="memItemLeft" align="right" valign="top"><a id="a1f6520c125e1db548f1a088ace7a042e" name="a1f6520c125e1db548f1a088ace7a042e"></a>
std::vector&lt; Point2 &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>orange_cones</b></td></tr>
<tr class="separator:a1f6520c125e1db548f1a088ace7a042e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a0a0a8309cd7ce17d5256b5e8435af151" name="a0a0a8309cd7ce17d5256b5e8435af151"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a0a8309cd7ce17d5256b5e8435af151">&#9670;&#160;</a></span>print_cones()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void slamISAM::print_cones </td>
          <td>(</td>
          <td class="paramtype">auto</td>          <td class="paramname"><span class="paramname"><em>logger</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; Point2 &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>cone_obs</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Prints the positions of the observed cones stored within the vector cone_obs. For DEBUGGING purposes. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cone_obs</td><td>A memory address to the vector containing the Point2 positions of the observed cones (You can just pass in the variable, but the type is std::vector&lt;Point2&gt; &amp;) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a00e82e306602f32451124afb29364365" name="a00e82e306602f32451124afb29364365"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00e82e306602f32451124afb29364365">&#9670;&#160;</a></span>step()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void slamISAM::step </td>
          <td>(</td>
          <td class="paramtype">auto</td>          <td class="paramname"><span class="paramname"><em>logger</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gtsam::Pose2</td>          <td class="paramname"><span class="paramname"><em>global_odom</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; Point2 &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>cone_obs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vector&lt; Point2 &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>orange_ref_cones</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">gtsam::Point2</td>          <td class="paramname"><span class="paramname"><em>velocity</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long</td>          <td class="paramname"><span class="paramname"><em>time_ns</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>loopClosure</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Updates iSAM2 model by first performing data association on the cones observed from current time stamp. After determining which of the observed cones are new cones, the new cones are added to the factor graph which will be used to update the iSAM2 model. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">logger</td><td>RCLCPP logger used to print information to the terminal</td></tr>
    <tr><td class="paramname">global_odom</td><td>Pose2 type representing the global pose of the car as predicted by the motion model. This will be updated by step to hold the global pose of the car after the current time step.</td></tr>
    <tr><td class="paramname">cone_obs</td><td>The memory address of the vector containing the relative positions (with respect to the car) of the cones observed at the current time step.</td></tr>
    <tr><td class="paramname">orange_ref_cones</td><td>The memory address of the vector containing the positions of the orange cones observed at the start of the track. Will be used for loop closure</td></tr>
    <tr><td class="paramname">velocity</td><td>The velocity of the car at the current time step. Used as a part of the motion model to calculate the current pose of the car.</td></tr>
    <tr><td class="paramname">time_ns</td><td>The time elapsed from the previous time step. Used as a part of the motion model to calculate the current pose of the car.</td></tr>
    <tr><td class="paramname">loopClosure</td><td>Boolean that will be updated if loop closure has been detected. </td></tr>
  </table>
  </dd>
</dl>
<p>Use the previous pose estimate from iSAM2, and velocity odometry info to calculate the current pose</p>
<p>Using a velocity-based motion model</p>
<p>Spawn num_threads that will are responsible for performing data association on subset of the observed cones</p>
<p>Populate m_dist</p>
<p>Why are we obtaining all the estimates for the global position of previously seen cones sequentially instead of using threads?</p>
<p>a.) When using threads, we will have to calculate the estimate for the same previously seen cone multiple times, for each observed cone. (wasted computation)</p>
<p>b.) Issue with multiple threads calculating estimates at once. This is a critical section in the code. Therefore, it is safer to calculate all estimates in a vector, where multiple threads can safely read from the the vector (even if reading the same element)</p>
<p>Find min_dist; do this for each (n_landmarks + 1) sub-section of m_dist</p>
<p>Finding the previously seen cone that is the most similar to the current observed cone by finding the previously seen cone that had the smallest mahalanobis distance with the observed cone.</p>
<p>If the smallest mahalanobis distance is M_DIST_TH (the last element in each (n_landmarks + 1) subsection of m_dist), then the current landmark/cone is a new cone</p>
<p>Print to squirrel.txt Every single time you run step, you reprint the isam2 estimates Remove the previous estimates (trunc) RCLCPP_INFO(logger, "graphing\n");</p>

</div>
</div>
<a id="ab07c8f29237621e0b929d4a7098bfd4f" name="ab07c8f29237621e0b929d4a7098bfd4f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab07c8f29237621e0b929d4a7098bfd4f">&#9670;&#160;</a></span>t_associate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void slamISAM::t_associate </td>
          <td>(</td>
          <td class="paramtype">vector&lt; Point2 &gt; *</td>          <td class="paramname"><span class="paramname"><em>cone_obs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vector&lt; Pose2 &gt; *</td>          <td class="paramname"><span class="paramname"><em>global_obs_cones</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vector&lt; Pose2 &gt; *</td>          <td class="paramname"><span class="paramname"><em>all_cone_est</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Pose2</td>          <td class="paramname"><span class="paramname"><em>global_odom</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vector&lt; float &gt; *</td>          <td class="paramname"><span class="paramname"><em>m_dist</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>lo</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>hi</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A function called by threads that will perform data association on the observed Point2 cones stored inside vector cone_obs. All calculated mahalanobis distances will be stored in vector m_dist. For a given time stamp, multiple threads will be spawned to calculate a subsection of the the mahalanobis distances from indices [lo, hi) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">global_obs_cones</td><td>A vector containing the global position for the Point2 cones observed in the current time stamp</td></tr>
    <tr><td class="paramname">all_cone_est</td><td>A vector containing the estimates for the poses of previously seen cones, calculated by the iSAM2 model</td></tr>
    <tr><td class="paramname">global_odom</td><td>A Pose2 variable representing the global pose of the car.</td></tr>
    <tr><td class="paramname">m_dist</td><td>A vector containing all the mahalanobis distance calculations that will need to be calculated for the current time stamp. Let n_landmarks represent the number of previously seen landmarks, m_dist is organized such that each set/multiple of n_landmarks + 1 elements corresponds to the mahalanobis distance between an observed cone and the global positions of all previously seen cones. The +1 represents the mahalanobis distance threshold (M_DIST_TH) These mahalanobis distances will be used to perform data association on the observed landmarks, by observing which previously seen cone had the smallest mahalanobis distance from the current observed cone. If the smallest distance is M_DIST_TH, then the current observed cone is a new cone</td></tr>
    <tr><td class="paramname">lo</td><td>An integer representing the index in m_dist the current thread should start populating m_dist</td></tr>
    <tr><td class="paramname">hi</td><td>An integer representing the index in m_dist the current thread should stop populating m_dist. Does not calculate the element at index hi </td></tr>
  </table>
  </dd>
</dl>
<p>calculate for how many previous cone estimates to calculate mahalanobis distance for, with respect to the current observation.</p>
<p>This is because the thread starts calculating mahalanobis distances starting at index lo, which may not be a multiple of n_landmarks + 1</p>
<p>(obs_id + 1): which multiple of (n_landmarks +1) depends on which observed cone</p>
<p>(n_landmarks + 1): n_landmarks for all previous landmarks and +1 for M_DIST_TH.</p>
<p>calculate difference between pose of current observed cone and previously seen cone</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>workspace/src/isam2/<a class="el" href="isam2_8cpp_source.html">isam2.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
